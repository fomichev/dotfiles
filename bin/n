#!/usr/bin/env ruby

require 'optparse'

edit = true

OptionParser.new do |opts|
  opts.banner = 'Usage: n [options] [name]'

  opts.on('-l', '--list', 'List all notes') do |v|
    edit = false
  end
end.parse!

root = File.join(ENV['HOME'], 'Dropbox', 'notes')
ext = 'txt'

$files = Dir.glob(File.join(root, '**', '*.txt')).map do
  |p| [ File.basename(p).sub(/\.#{ext}$/, '').downcase, p ]
end

def command_edit(name)
  file, = $files.select { |e| e[0] == name }

  abort "Note '#{name}' does not exist" unless file

  system("$EDITOR '#{file[1]}'")
end

def command_list
  $files.each { |e| puts e[0] }
end

if edit
  command_edit(ARGV.join(' '))
else
  command_list
end
